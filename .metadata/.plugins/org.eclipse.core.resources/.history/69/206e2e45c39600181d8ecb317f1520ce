package com.runsystem.datnt.business;

import java.util.List;

import com.runsystem.datnt.database.service.StudentInfoService;
import com.runsystem.datnt.dto.Pagenation;
import com.runsystem.datnt.dto.PagenationResult;
import com.runsystem.datnt.dto.Student;
import com.runsystem.datnt.dto.StudentInfo;

public class SearchStudent {
	
	public PagenationResult search(Pagenation pageSearch, StudentInfoService searchResult, int page) {
		Student          student = new Student(page, pageSearch.getStudentCode(), pageSearch.getStudentName());
		
		int numRow = searchResult.count(student);
		int maxPage = numRow % 10 == 0 ? numRow/10 : numRow/10 + 1;
		
		System.out.println(numRow + "   " + maxPage);
		
		if (maxPage == 0) {
			return null;
		}
		pageSearch.setStartSearch((page - 1)*10);
		PagenationResult result  = new PagenationResult();
		List<StudentInfo> students = searchResult.selectLimit(pageSearch);
		result.setStudents(students);
		result.setIndexPage(page);
		result.setMaxPage(maxPage);
		
		if (page < 5) {
			result.setStartPage(1);
			result.setEndPage(maxPage > 5 ? 5 : maxPage); 
		} else {
			if (page + 2 <= maxPage) {
				result.setEndPage(page + 2);
				result.setStartPage(result.getEndPage() - 4);
			}
		}
		
		System.out.println("Page: " + page);
		System.out.println("Start search: " + pageSearch.getStartSearch());
		System.out.println("index: " + result.getIndexPage());
		System.out.println("start: " + result.getStartPage());
		System.out.println("end: " + result.getEndPage());
		System.out.println("Max page: " + result.getMaxPage());
		
		return result;
	}

}


jQuery(document).ready(function() {
	
	$("#mytable #checkall").click(function () {
        if ($("#mytable #checkall").is(':checked')) {
            $("#mytable input[type=checkbox]").each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#mytable input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    /*
        Form validation
    */
    $('.login-form input[type="text"], .login-form input[type="password"], .login-form textarea').on('focus', function() {
    	$(this).removeClass('input-error');
    });
    
    $('.login-form').on('submit', function(e) {
    	
    	$(this).find('input[type="text"], input[type="password"], textarea').each(function(){
    		if( $(this).val() == "" ) {
    			e.preventDefault();
    			$(this).addClass('input-error');
    		}
    		else {
    			$(this).removeClass('input-error');
    		}
    	});
    	
    });
    
    /*
     * send post request to controller  
     */
	$('#login').on('submit', function(e) {
		e.preventDefault();
		$.ajax({
			async   : false,
			type    : 'post',
			url     : '/datnt/login',
			data    : $(this).serialize(),
			success : function(result) {
				if ($.trim(result)) {
					window.location.href=result;
				} else {
					alert("Invalid username or password!");
				}
			}
		});
	});
	
	
	
	$('#create-form').on('submit', function(e) {
		e.preventDefault();
		$.ajax({
			type    : 'post',
			url     : '/datnt/admin/create',
			data    : $(this).serialize(),
			success : function(result) {
				
				if (result) {
					alert("Create new student successful.");
				} else {
					alert("Can not create new student.");
				}
			}
		});
	});
	
	$("#form-search").on('submit', function(e) {
		e.preventDefault();
		
		$.ajax({
			type : 'post',
			url  : '/datnt/admin/search',
			data : $(this).serialize(),
			success : function(result) {
				if ($.trim(result)) {
					showResults(result.students);
					showPagenation(result.indexPage, result.startPage, result.endPage, result.maxPage);
				} else {
					alert("Invalid student code or student name");
				}
			}
		});
		
	});
	
	$(".edit-btn").click(function(e) {
		alert($(this).attr("value"));
	});
});

function showResults(list) {
	var html = '';
	list.forEach(function(item) {
		html += '<tr>'+
		'<td><input type="checkbox" class="checkthis" name="id" value="' + item.studentId + '"/></td>' +
		' <td>' + item.studentCode + '</td>' + 
		' <td>' + item.studentName + '</td>' +
		' <td>' + item.dateOfBirth + '</td>' +
		' <td>' + item.avgScore    + '</td>' + 
		' <td>' + item.address     + '</td>' +
		'<td><p><button class="btn btn-primary btn-xs edit-btn" ' + 
		'data-title="Edit" data-toggle="modal" '         +
		'data-target="#edit" data-placement="top" '      + 
		'rel="tooltip" onclick="getInfoUpdate(' + item.studentId + ');"><span class="glyphicon glyphicon-pencil"></span></button></p></td> ' + 
		'<td><p><button class="btn btn-danger btn-xs remove-btn" '  + 
		'data-title="Delete" data-toggle="modal" '       + 
		'data-target="#delete" data-placement="top" '    + 
		'rel="tooltip"><span class="glyphicon glyphicon-trash"></span></button></p></td>';
	});
	$("#table-result").html(html);
}

function editClick() {
	alert("adsdasd");
}

function pageClick(param) {
	$.ajax({
		type : 'get',
		url  : '/datnt/admin/search?page=' + param,
		success : function(result) {
			if ($.trim(result)) {
				showResults(result.students);
				showPagenation(result.indexPage, result.startPage, result.endPage, result.maxPage);
			}
		}
	});
}

function pageDirect(param) {
	
	if(param === "next") {
		alert("asdasdadsad");
	}
	
	$.ajax({
		type : 'get',
		url  : '/datnt/admin/search/direct?type=' + param,
		success : function(result) {
			if ($.trim(result)) {
				showResults(result.students);
				showPagenation(result.indexPage, result.startPage, result.endPage, result.maxPage);
			}
		}
	});
}

function getInfoUpdate(param) {
	$.ajax({
		type : 'get',
		url  : '/datnt/admin/update?param=' + param,
		success : function(result) {
			
		}
	});
}

function showPagenation(index, start, end, maxPage) {
	var pre = '';
	var next = '';
	var pages = '';
	
	if (index > 1) {
		pre = '<li id="prev"><a href="#" data-toggle="tooltip" title="Previous" onclick="pageDirect(-1);"><span class="glyphicon glyphicon-chevron-left"></span></a></li>';
	} else {
		pre = '<li id="prev" class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-left"></span></a></li>';
	}
	if (index == maxPage) {
		next = '<li id="next" class="disabled"><a href="#"><span class="glyphicon glyphicon-chevron-right"></span></a></li>';
	} else {
		next = '<li id="next"><a href="#" data-toggle="tooltip" title="Next" onclick="pageDirect(1)"><span class="glyphicon glyphicon-chevron-right"></span></a></li>';
	}
	for ( let i = start; i <= end; i++) {
		if (index == i) {
			pages += ' <li class="active"><a href="#">'+ i + '</a></li>';
		} else {
			pages += ' <li><a href="#" onclick="pageClick(' + i + ')">'+ i + '</a></li>';
		}
	}

	$(".pagination").html(pre + pages + next);
}

$(function () {
    $("[rel='tooltip']").tooltip();
});